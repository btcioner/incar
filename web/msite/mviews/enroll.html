
<!DOCTYPE html>
<html>
<head>
    <title>欢迎注册</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <script  src="../mscripts/jquery-1.7.1.min.js"></script>
    <script  src="../mscripts/car.js"></script>


    <script  src="../mscripts/jquery.mobile.min.js"></script>

    <link rel="stylesheet" href="../mstyles/jquery.mobile.min.css">


<style >
        .textfield{
            height:26px; font-size:16px;padding: 0;
        }
    </style>
 <script type="text/javascript">
  var user;//用户openId
  //var webserviceurl;//webservice地址
  var today;//当天日期
  //获取传入的参数
  function getQueryString(name) {
    var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
    var r = window.location.search.substr(1).match(reg);
    if (r != null) return unescape(r[2]); return null;
    }
   //alert(getQueryString("user"));

 
  //页面加载初始化
  function init(){
        //获取当前日期，初始化日期控件
           today = new Date();
        //获取user的微信openId
			user=getQueryString("user");
		//获取汽车品牌、车型数据
		    initPro();
		  //
      document.getElementById("user").value=user;
      //document.getElementById("obd_code").value="WFQ00013044";
      document.getElementById("owner_flag").value=1;
      document.getElementById("enroll_time").value=today;
		  
   }

  //提交注册数据
  function reg(){
      if($('#obd_code').val()==null||$('#obd_code').val().length<1){alert("请填写OBD编号");return;}
      if($('#username').val()==null||$('#username').val().length<1){alert("请填写用户名");return;}
      if($('#password').val()==null||$('#password').val().length<1){alert("请填写密码");return;}
      if($('#brand').val()==null||$('#brand').val()=='-1'){alert("请选择汽车品牌");return;}
      if($('#selectSeries').val()==null||$('#selectSeries').val()=='-1'){alert("请选择品牌系列");return;}
      if($('#manuyear').val()==null||$('#manuyear').val()=='-1'){alert("请选择年款");return;}
      if($('#ownername').val()==null||$('#ownername').val().length<1){alert("请填写车主姓名");return;}
      if($('#phonenumber').val()==null||$('#phonenumber').val().length<1){alert("请填写联系电话");return;}
      if($('#currentMileage').val()==null||$('#currentMileage').val().length<1){alert("请填写当前里程");return;}
      if($('#enginetype').val()==null||$('#enginetype').val().length=='-1'){alert("请选择发动机类型");return;}
      if($('#displacement').val()==null||$('#displacement').val().length<1){alert("请填写排气量");return;}
      if($('#carage').val()==null||$('#carage').val().length=='-1'){alert("请选择车龄");return;}
      if($('#password').val()!=$('#pwdagain').val()){
          alert("密码不一致");
          return;
      }else{
      var postData = {};
      postData.openid = user;
      postData.owner_flag = 1;
      postData.obdCode = document.getElementById("obd_code").value;
      postData.enroll_time = today;
      postData.name=$("#ownername").val();
      postData.phone=$("#phonenumber").val();
      postData.brand=$("#brand").val();
      postData.seriese=$("#selectSeries").val();
      postData.modelYear=$("#manuyear").val();
      postData.license=$("#platenumber").val();
      postData.mileage=$("#currentMileage").val();
      postData.enginetype=$("#enginetype").val();
      postData.displacement=$("#displacement").val();
      postData.carage=$("#carage").val();
      $.ajax({
          type: "POST",
          url: "/mservice/enroll",
          data: postData,
          dataType: "text",
          success: function (result,status) {
              alert("注册成功");
              // document.getElementById("Tip").innerHTML=result;
              window.close();
           },
          error:function(XMLHttpRequest, textStatus, errorThrown){
              alert("注册失败\n请检查OBD Id是否正确");
          }
      });
   }
  }
</script>
</head>
<body onLoad="init()" style="padding: 2;text-align: center">
<h4>欢迎注册</h4>
<img src="../mimages/logo.jpg" width="100%" height="50px">

 <div id="enroll"  style="margin-bottom:30px; margin-top:10px;font-size:16px">
(带<span style="color:red;">*</span>为必填项)

   <form id="enrollFom" method="post" action="/mservice/enroll">
     <input type="hidden" id="user" name="user" />
     <input type="hidden" id="owner_flag" name="owner_flag" />
     <input type="hidden" id="enroll_time" name="enroll_time" />
     <table style="font-size:14px;border-collapse: collapse; border-spacing:  0 " >
       <tr><td style="text-align:right;" width="35%">用户名<span style="color:red">*</span></td><td  width="65%"><input type="text" id="username" name="username" class="textfield"/></td></tr>
       <tr><td style="text-align:right;" width="35%">OBD&nbsp;Id<span style="color:red">*</span></td><td  width="65%"><input type="text" id="obd_code" name="obd_code" class="textfield" /></td></tr>
         <tr><td style="text-align:right;">密码<span style="color:red">*</span></td><td><input type="password" id="password" name="password" class="textfield"/></td></tr>
         <tr><td style="text-align:right;">重复密码<span style="color:red">*</span></td><td><input type="password" id="pwdagain" name="pwdagain" class="textfield"/></td></tr>
       <tr><td style="text-align:right;">汽车品牌<span style="color:red">*</span></td><td><select id="brand" name="brand"  style="font-size:20px" data-native-menu="true"><option value="-1" >请选择</option></select></td></tr>
       <tr><td style="text-align:right;">系列<span style="color:red">*</span></td><td><select id="selectSeries" name="selectSeries" style="font-size:20px"><option value="-1" >请选择</option></select></td></tr>
       <tr><td style="text-align:right;">年款<span style="color:red">*</span></td><td><select id="manuyear" name="manuyear" style="font-size:20px"><option value="-1">请选择</option><option>2000</option><option>2001</option><option>2002</option><option>2003</option><option>2004</option><option>2005</option><option>2006</option><option>2007</option><option>2008</option><option>2009</option><option>2010</option><option>2011</option><option>2012</option><option>2013</option><option>2014</option><option>2015</option></select></td></tr>
       <tr><td style="text-align:right;">车主姓名<span style="color:red">*</span></td><td><input type="text" id="ownername" name="ownername" class="textfield" /></td></tr>
       <tr><td style="text-align:right;">联系电话<span style="color:red">*</span></td><td><input type="text" id="phonenumber" name="phonenumber" class="textfield"/></td></tr>
       <tr><td style="text-align:right;">车牌号</td><td><input type="text" id="platenumber" name="platenumber" class="textfield" /></td></tr>
       <tr><td style="text-align:right;">当前里程<span style="color:red">*</span></td><td><input type="text" id="currentMileage" name="currentMileage" class="textfield" /></td></tr>
       <tr><td style="text-align:right;">发动机类型<span style="color:red">*</span></td><td><select id="enginetype" name="displace" class="textfield" ><option value="-1" >请选择</option><option>自然吸气</option><option>涡轮增压</option></select></td></tr>
       <tr><td style="text-align:right;">排气量<span style="color:red">*</span></td><td><input type="text" id="displacement" name="displacement" class="textfield" /></td></tr>
       <tr><td style="text-align:right;">车龄<span style="color:red">*</span></td><td><select  id="carage" name="carage" class="textfield" ><option value="-1" >请选择</option><option value="0">1年以下</option><option value="1">1-2年</option><option value="2">2-5年</option><option value="5">5-10年</option><option value="10">10年以上</option></select></td></tr>
     </table>
  </form>
     <div id="Tip"></div>
     <p align="center"><input type="button" value="&nbsp;注&nbsp;&nbsp;册&nbsp;"   class="textfield" style="width:100%; height:60px" onclick="reg()"/>
  </div>
</body>
</html>
