<!DOCTYPE>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>行车分析</title>
<!--rickshaw图表控件资源  -->
    <script  src="../mscripts/d3.min.js"></script>
    <script  src="../mscripts/rickshaw.min.js"></script>

    <link type="text/css" rel="stylesheet" href="../mstyles/graph.css">
    <link type="text/css" rel="stylesheet" href="../mstyles/lines.css">

    <!--rickshaw图表控件资源结束  -->
    <script  src="../mscripts/jquery-1.7.1.min.js"></script>
    <script  src="../mscripts/car.js"></script>

    <!--日期控件资源  -->
    <script  src="../mscripts/jqm-datebox-1.4.0.comp.flipbox.min.js"></script>
    <script  src="../mscripts/jquery.mobile.min.js"></script>
    <link rel="stylesheet" href="../mstyles/jquery.mobile.min.css">
    <link rel="stylesheet" href="../mstyles/jqm-datebox.min.css">
    <!--日期控件资源结束  -->
    <link href="../mstyles/pagestyle.css" rel="stylesheet" type="text/css" />
    <link href="../mstyles/menustyle.css" rel="stylesheet" type="text/css" />
    <script  src="../mscripts/highcharts.js"></script>
    <!--<script  src="../mscripts/exporting.js"></script>-->
    <script type="text/javascript">
	//var tabIds=["menu_icon1","menu_icon2","menu_icon3","menu_icon4"];
	$(function(){
		//获得样式为menu的ul下面所有li下面所有的a，给他们绑定click事件
		$("#menu_box>ul>li>a").click(onMenuClick);
	});
	function onMenuClick(){
		var clickId=$(this).attr("id");
		var boxId=clickId.replace("menu_icon","mainbox");
		$("#main_wrap>div").hide();
		$("#menu_box>ul>li>a").each(function(){
			var id=$(this).attr("id");
			if(id===clickId){
				$(this).removeClass().addClass(id+"b");
				$("#"+boxId).show();
			}
			else{
				$(this).removeClass().addClass(id+"a");
			}
		});
	}
</script>
<style scoped>
        #fuel_chart {
            position: relative;
            float: left;
            width: 85%;
        }
        #fuel_y_axis {
            position: relative;
            float: left;
            width: 20px;
            height:200px;
        }
        #carbon_chart {
            position: relative;
            float: left;
            width: 85%;
        }
        #carbon_y_axis {
            position: relative;
            float: left;
            width: 20px;
            height:200px;
        }
        #drive_chart {
            position: relative;
            float: left;
            width: 85%;
        }
        #drive_y_axis {
            position: relative;
            float: left;
            width: 30px;
            height:200px;
        }
    </style>
    <script type="text/javascript">
        var user;//用户openid
        var fuelChartData;//图表数据
        var carbonChartData;//图表数据
        var behaviorChartData;
        var today;
        //本地数据，用于演示
        fuelChartData = [
            {data:[{x: 0,y: 3.128},
                {x: 1, y: 7.345},{x: 2,y: 7.467},{x: 3, y: 7.098}, {x: 4, y: 7.761}, {x: 5, y: 7.257 }],
                color: "#c05020"}
        ];
        carbonChartData = [
            {data:[{x: 0,y: 1},
                {x: 1, y: 1},{x: 2,y: 1},{x: 3, y: 1}, {x: 4, y:1}, {x: 5, y: 1 }],
                color: "#c05020"}
        ];
        //页面加载初始化
        function init(){
            //获取当前日期，初始化日期控件
            today = new Date();
            year=today.getFullYear();    //获取完整的年份(4位,1970-????)
            month=(today.getMonth()+1>9)?today.getMonth()+1:"0"+(today.getMonth()+1);     //获取当前月份(0-11,0代表1月)
            day=today.getDate()>9?today.getDate():"0"+today.getDate();;        //获取当前日(1-31)
            document.getElementById("start").value=year+"-"+month+"-01";
            document.getElementById("end").value=year+"-"+month+"-"+day;
            document.getElementById("fuel_chartStart").innerHTML=year+"-"+month+"-01";
            document.getElementById("fuel_chartEnd").innerHTML=year+"-"+month+"-"+day;
            document.getElementById("carbon_chartStart").innerHTML=year+"-"+month+"-01";
            document.getElementById("carbon_chartEnd").innerHTML=year+"-"+month+"-"+day;
            document.getElementById("drive_chartStart").innerHTML=year+"-"+month+"-01";
            document.getElementById("drive_chartEnd").innerHTML=year+"-"+month+"-"+day;
            user=getQueryString("user");
            //createChart();
            //获取最近一次行驶、最近7天、最近30天数据、默认图表数据

            getDefaultData(user);
            //修改分享链接
            shareToFriend();
            shareToWeibo();
            shareTo();
        }

        //按时间段查询
        function search(){
            //判断开始、结束时间是否合法
            var beginDate=new Date($('#start').val());
            var endDate=new Date($('#end').val());
            if(beginDate>=endDate) return;
            else {
                //获取指定时间段数据
                getdatafromdate(user,beginDate,endDate);
                //修改分享链接
                shareToFriend();
                shareToWeibo();
                shareTo();
            }
        }
    </script>
</head>

<body onload="init()">
<div id="wrap">

  <!--menu_box start--><div id="menu_box">
    <!--ULmenu start--><ul class="menu">
    <li><a id="menu_icon1" href="###" class="menu_icon1b">油&nbsp;&nbsp;&nbsp;&nbsp;耗</a></li>
    <li><a id="menu_icon2" href="###" class="menu_icon2a">碳排放量</a></li>
    <li><a id="menu_icon3" href="###" class="menu_icon3a">驾驶偏好</a></li>
    <li><a id="menu_icon4" href="###" class="menu_icon4a">速段统计</a></li>
</ul><!--ULmenu end-->
    <div class="clear"></div>
</div><!--meun_box end-->
      <div class="clear"></div>
  </div><!--meun_box end-->
  <!--datebox_01 start--><div id="datebox_01">
  <ul>
  <li style="width: 10% ;float: left;margin-top: 20px">开始：</li>
      <li style="width: 35%;float: left"><input name="start" class="w108" type="date" data-options='{"mode":"flipbox"}' data-role="datebox" id="start" style="vertical-align:middle;" oninput="search()" /></li>

      <li style="width: 10%;float: left;margin-top: 20px;margin-left: 10px">结束：</li>
      <li style="width: 35%;float: left"><input name="end" class="w108" type="date" data-options='{"mode":"flipbox"}' data-role="datebox" id="end" style="vertical-align:middle;" oninput="search()"/></li>
  </ul>  
  <div class="clear"></div>
  </div><!--datebox_01 end-->
  <!--main_wrap start-->
  <div id="main_wrap">
     <!--mainbox1油耗内容 star--><div id="mainbox1">
       <!--文字部分区1 start-->
      <br>
      <div>
       <div class="boxstyle01_1"><span>最近一次行驶</span></div>
       <div class="boxstyle02">
         <ul>
         <li>平均油耗为：<span id="lastFuel">7.0升/百公里</span></li>
         <li>行驶里程数：<span id="lastMiles">17.0公里</span></li>
         <li>耗&nbsp;&nbsp;油&nbsp;&nbsp;量为：<span id="lastTotalFuel">2.30升</span></li>
         </ul>
       </div>
       <div class="clear"></div>
       </div><!--文字部分区1 end-->
       <div class="h18"></div>
       <!--文字部分区2 start-->
      <!--<div>
      <div class="boxstyle01_1">本周行驶</div>
      <div class="boxstyle02">
        <ul>
        <li>平均油耗为：<span id="weekFuel">7.2升/百公里</span></li>
        <li>行驶里程数：<span id="weekMiles">216.0公里</span></li>
        <li>耗&nbsp;&nbsp;油&nbsp;&nbsp;量为：<span id="weekTotalFuel">18.70升</span></li>
        </ul>
      </div>
      <div class="clear"></div>
      </div>-->
     <!--文字部分区2 end-->
      <br>
       <div class="h18"></div>
       <!--文字部分区3 start--><div>
       <div class="boxstyle01_1"><span>本时间段行驶</span></div>
       <div class="boxstyle02">
         <ul>
         <li>平均油耗为：<span id="avgFuel">7.1升/百公里</span></li>
         <li>行驶里程数：<span id="miles">468.0公里</span></li>
         <li>耗&nbsp;&nbsp;油&nbsp;&nbsp;量为：<span id="totalFuel">157.30升</span></li>
         </ul>
       </div>
       <div class="clear"></div>
       </div><!--文字部分区3  end-->
       <!--imgbox01图片区1 start-->
       <div class="imgbox01">
         <div class="chart-wrapper" style="margin-bottom: 10px;">
             <div id="fuel_y_axis"></div>
             <div id="fuel_chart"></div>
         </div>
         <div id="fule_note" style="text-align:center;margin-top: 20px;vertical-align: middle;margin-top: 215px;margin-left: 30px">
             <div style="text-align: left;width: 49%;float: left" id="fuel_chartStart"></div>
             <div style="text-align: right;width: 49%;float: left" id="fuel_chartEnd"></div>
         </div>
       </div><!--imgbox01图片区1 end-->
     </div><!--mainbox1油耗内容 end-->
     <!--mainbox2碳排放内容 star--><div id="mainbox2" style="display:none;">
       <!--文字部分区1 start--><div class="text_01" style="text-align: left;padding-left: 20px">
         <span>本&nbsp;&nbsp;&nbsp;&nbsp;次</span>行驶碳排放参考量为：<span id="lastCarbon">7.0kg</span><br />
      <!--<span>本周</span>行驶碳排放参考量为：<span id="weekCarbon">24kg</span><br />-->
      <span>本时间段</span>行驶碳排放参考量为：<span id="monthCarbon">256kg</span>
    </div><!--文字部分区1 end-->
       <!--imgbox01图片区1 start--><div class="imgbox01">
         <div class="chart-wrapper" style="margin-bottom: 10px;">
               <div id="carbon_y_axis"></div>
               <div id="carbon_chart"></div>
         </div>
        <div id="carbon_note" style="text-align:center;margin-top: 20px;vertical-align: middle;margin-top: 215px;margin-left: 30px">
            <div style="text-align: left;width: 49%;float: left" id="carbon_chartStart"></div>
            <div style="text-align: right;width: 49%;float: left" id="carbon_chartEnd"></div><br>
        </div>
       </div><!--imgbox01图片区1 end-->
      </div><!--mainbox2碳排放内容 end-->
      <!--mainbox3驾驶偏好内容 star--><div id="mainbox3" style="display:none;">
      <!--文字部分区1 start--><div>
       <div class="boxstyle01_1"><span>最近一次行驶</span></div>
       <div class="boxstyle02">
         <ul>
         <li>急转弯次数：<span id="lastTurn"></span></li>
         <li>急加速次数：<span id="lastSpeedup"></span></li>
         <li>急减速次数：<span id="lastSpeeddown"></span></li>
         </ul>
       </div>
       <div class="clear"></div>
       </div><!--文字部分区1 end-->
       <div class="h18"></div>
       <!--文字部分区2 start<!--
      <!--
      <div>
       <div class="boxstyle01_1">本周行驶</div>
       <div class="boxstyle02">
         <ul>
         <li>急转弯次数：<span id="weekTurn"></span></li>
         <li>急加速次数：<span id="weekSpeedup"></span></li>
         <li>急减速次数：<span id="weekSpeeddown"></span></li>
         </ul>
       </div>
       <div class="clear"></div>
       </div>-->
      <!--文字部分区2 end-->
       <div class="h18"></div>
       <!--文字部分区3 start-->
      <br>
      <div>
       <div class="boxstyle01_1"><span>本时间段行驶</span></div>
       <div class="boxstyle02">
         <ul>
         <li>急转弯次数：<span id="nonthTurn"></span></li>
         <li>急加速次数：<span id="monthSpeedup"></span></li>
         <li>急减速次数：<span id="monthSpeeddown"></span></li>
         </ul>
       </div>
       <div class="clear"></div>
       </div><!--文字部分区3  end-->
       <!--imgbox01图片区1 start--><div class="imgbox01" style="margin-bottom: 10px;position: static;margin-left: -15%">
         <div class="chart-wrapper" >
             <div id="drive_y_axis"></div>
             <div id="drive_chart"></div>
        </div>
        <div id="note" style="text-align:center;vertical-align: middle;margin-top: 190px;margin-left: 30px">
             <div style="text-align: left;width: 49%;float: left" id="drive_chartStart"></div>
             <div style="text-align: right;width: 49%;float: left" id="drive_chartEnd"></div><br>
             <div style="width: 10px;background:#c05020;height: 5px;float: left;margin-top: 5px;margin-left: 20px" ></div>
             <div style="float: left;margin-left: 10px;margin-right: 20px">急加速</div>
             <div style="width: 10px;background:#30c020;height: 5px;float: left;margin-top: 5px" ></div>
             <div style="float: left;margin-left: 10px;margin-right: 20px">急减速</div>
             <div style="width: 10px;background:#6060c0;height: 5px;float: left;margin-top: 5px" ></div>
             <div style="float: left;margin-left: 10px;margin-right: 20px">急转弯</div>
        </div>
       </div><!--imgbox01图片区1 end-->
      </div><!--mainbox3驾驶偏好内容 end-->  
      <!--mainbox4速段统计内容 star--><div id="mainbox4" style="display:none;">
      <!--文字部分区1 start-->
      <br>
      <div>
       <div class="boxstyle01_2"><span>最近一次行驶</span></div>
       <div class="boxstyle02">
         <ul>
             <li>时速45公里以下行驶里程<span id="lastSlowSpeed"></span>公里;</li>
             <li>时速45到90公里行驶里程<span id="lastMiddleSpeed"></span>公里;</li>
             <li>时速90公里以上<span id="lastHighSpeed"></span>公里</li>
         </ul>
       </div>
       <div class="clear"></div>
       </div><!--文字部分区1 end-->
       <div class="h18"></div>
       <!--文字部分区2 start-->
      <!--<div>
       <div class="boxstyle01_2">本周行驶</div>
       <div class="boxstyle02">
         <ul>
             <li>时速45公里以下行驶里程<span id="weekSlowSpeed"></span>公里;</li>
             <li>时速45到90公里行驶里程<span id="weekMiddleSpeed"></span>公里;</li>
             <li>时速90公里以上<span id="weekHighSpeed"></span>公里</li>
         </ul>
       </div>
       <div class="clear"></div>
       </div>-->
      <!--文字部分区2 end-->
       <div class="h18"></div>
       <!--文字部分区3 start-->
      <br>
      <div>
       <div class="boxstyle01_2"><span>本时间段行驶</span></div>
       <div class="boxstyle02">
         <ul>
             <li>时速45公里以下行驶里程<span id="monthSlowSpeed"></span>公里;</li>
             <li>时速45到90公里行驶里程<span id="monthMiddleSpeed"></span>公里;</li>
             <li>时速90公里以上<span id="monthHighSpeed"></span>公里</li>
         </ul>
       </div>
       <div class="clear"></div>
       </div><!--文字部分区3  end-->
       <!--imgbox01图片区1 start-->
      <div id="container" style="min-width: 310px;width: 75%; height: 200px; margin-left: 5px;margin-top: 20px;padding: 0">


  </div><!--imgbox01图片区1 end-->
      </div><!--mainbox4速段统计内容 end--> 
    
  </div><!--main_wrap end-->
</div>
<script>
    //分享到微信朋友圈
    function shareToFriend(){
        str=location.href;
        var beginDate=new Date($('#start').val());
        var endDate=new Date($('#end').val());
        title="我的行车数据";
        desc="分享我的行车数据";
        link=str.substring(0,str.lastIndexOf('/'))+"/myDriveShare.html?user="+user+"&start="+beginDate.toDateString()+"&end="+endDate.toDateString();
        weixinShareTimeline(title,desc,link,"");
    }
    //分享到腾讯微博
    function shareToWeibo(){
        str=location.href;
        var beginDate=new Date($('#start').val());
        var endDate=new Date($('#end').val());
        title="我的行车数据";
        link=str.substring(0,str.lastIndexOf('/'))+"/myDriveShare.html?user="+user+"&start="+beginDate.toDateString()+"&end="+endDate.toDateString();
        weixinShareWeibo(title,link);
    }
    // 发送给好友;
    function shareTo(){
        str=location.href;
        var beginDate=new Date($('#start').val());
        var endDate=new Date($('#end').val());
        title="我的行车数据";
        desc="分享我的行车数据";
        link=str.substring(0,str.lastIndexOf('/'))+"/myDriveShare.html?user="+user+"&start="+beginDate.toDateString()+"&end="+endDate.toDateString();
        weixinShareFriend(title,desc,link,"");
    }
    //将传回的油耗数据转换为图表控件所需格式
    function fuelChartDataConvert(data){
        var fuelData=new Array();
        fuelData[0]={};
        fuelData[0].color="#c05020";
        fuelData[0].data=new Array();
        for(i=0;i<data.length;i++){
            fuelData[0].data[i]={}
            fuelData[0].data[i].x=i;
            fuelData[0].data[i].y=parseFloat(data[i].fuel);
        }
        return fuelData;
    }
    //将传回的碳排放数据转换为图表控件所需格式
    function carbonChartDataConvert(data){
        var carbonData=new Array();
        carbonData[0]={};
        carbonData[0].color="#c05020";
        carbonData[0].data=new Array();
        for(i=0;i<data.length;i++){
            carbonData[0].data[i]={}
            carbonData[0].data[i].x=i;
            carbonData[0].data[i].y=parseFloat(data[i].carbon);
        }
        return carbonData;
    }

    //创建曲线图
    function createChart(){
        var fuel_graph = new Rickshaw.Graph( {
            element: document.getElementById("fuel_chart"),
            renderer: 'line',
            height: 200,
            width: 260,
            series:fuelChartData
        } );
        var fuel_y_ticks = new Rickshaw.Graph.Axis.Y( {
            graph: fuel_graph,
            orientation: 'left',
            tickFormat: Rickshaw.Fixtures.Number.formatKMBT,
            element: document.getElementById('fuel_y_axis')
        } );
        fuel_graph.render();
        var carbon_graph = new Rickshaw.Graph( {
            element: document.getElementById("carbon_chart"),
            renderer: 'line',
            height: 200,
            width: 260,
            series:carbonChartData
        } );
        var carbon_y_ticks = new Rickshaw.Graph.Axis.Y( {
            graph: carbon_graph,
            orientation: 'left',
            tickFormat: Rickshaw.Fixtures.Number.formatKMBT,
            element: document.getElementById('carbon_y_axis')
        } );
        carbon_graph.render();
        var drive_graph = new Rickshaw.Graph( {
            element: document.getElementById("drive_chart"),
            renderer: 'line',
            height: 200,
            width: 320,
            series:behaviorChartData
        } );
        var drive_y_ticks = new Rickshaw.Graph.Axis.Y( {
            graph: drive_graph,
            orientation: 'left',
            tickFormat: Rickshaw.Fixtures.Number.formatKMBT,
            element: document.getElementById('drive_y_axis')
        } );
        drive_graph.render();
    }
    //获取默认数据
    function getDefaultData(user){
        var start=new Date();
        start.setDate(1);
        //alert(start);alert(today);
        $.ajax({
            type: "post",
            url: "/mservice/myDriveData",
            data: {user:user,start:start.toDateString(),'end':today.toDateString()},
            dataType: "json",
            success: function (result,status) {
                //alert(result.length);
                document.getElementById("lastFuel").innerHTML=result.fuelDataLastTime.fuel+"升/百公里";
                document.getElementById("lastMiles").innerHTML=result.fuelDataLastTime.mileage+"公里";
                document.getElementById("lastTotalFuel").innerHTML=result.fuelDataLastTime.totalFuel+"升";
                //document.getElementById("weekFuel").innerHTML=result.fuelDataLastWeek.fuel+"升/百公里";
                //document.getElementById("weekMiles").innerHTML=result.fuelDataLastWeek.mileage+"公里";
                //document.getElementById("weekTotalFuel").innerHTML=result.fuelDataLastWeek.totalFuel+"升";
                document.getElementById("avgFuel").innerHTML=result.fuelDataLastInterval.fuel+"升/百公里";
                document.getElementById("miles").innerHTML=result.fuelDataLastInterval.mileage+"公里";
                document.getElementById("totalFuel").innerHTML=result.fuelDataLastInterval.totalFuel+"升";

                if(result.fuelData.length>1){
                    fuelChartData=fuelChartDataConvert(result.fuelData);
                }

                document.getElementById("fuel_chart").innerHTML="";
                document.getElementById("fuel_y_axis").innerHTML="";

                if(result.carbonData.length>1){
                    carbonChartData=carbonChartDataConvert(result.carbonData);
                }

                document.getElementById("lastCarbon").innerHTML=result.carbonDataLastTime.carbon+"kg";
                //document.getElementById("weekCarbon").innerHTML=result.carbonDataLastWeek.carbon+"kg";
                document.getElementById("monthCarbon").innerHTML=result.carbonDataLastInterval.carbon+"kg";
                document.getElementById("carbon_chart").innerHTML="";
                document.getElementById("carbon_y_axis").innerHTML="";

                document.getElementById("lastTurn").innerHTML=result.behaviorDataLatestTime.turnLatestTime;
                document.getElementById("lastSpeedup").innerHTML=result.behaviorDataLatestTime.speedupLatestTime;
                document.getElementById("lastSpeeddown").innerHTML=result.behaviorDataLatestTime.speeddownLatestTime;
                //document.getElementById("weekTurn").innerHTML=result.behaviorDataLatestWeek.turnLatestWeek;
                //document.getElementById("weekSpeedup").innerHTML=result.behaviorDataLatestWeek.speedupLatestWeek;
                //document.getElementById("weekSpeeddown").innerHTML=result.behaviorDataLatestWeek.speeddownLatestWeek;
                document.getElementById("nonthTurn").innerHTML=result.behaviorDataInterval.turnInterval;
                document.getElementById("monthSpeedup").innerHTML=result.behaviorDataInterval.speedupInterval;
                document.getElementById("monthSpeeddown").innerHTML=result.behaviorDataInterval.speeddownInterval;
                if(result.behaviorData.length>1){
                    behaviorChartData= driveChartDataConvert(result.behaviorData);
                }

                createChart();
                document.getElementById("lastSlowSpeed").innerHTML=result.lastSpeed.slow;
                document.getElementById("lastMiddleSpeed").innerHTML=result.lastSpeed.middle;
                document.getElementById("lastHighSpeed").innerHTML=result.lastSpeed.high;
                //document.getElementById("weekSlowSpeed").innerHTML=result.weekSpeed.slow;
                //document.getElementById("weekMiddleSpeed").innerHTML=result.weekSpeed.middle;
                //document.getElementById("weekHighSpeed").innerHTML=result.weekSpeed.high;
                document.getElementById("monthSlowSpeed").innerHTML=result.intervalSpeed.slow;
                document.getElementById("monthMiddleSpeed").innerHTML=result.intervalSpeed.middle;
                document.getElementById("monthHighSpeed").innerHTML=result.intervalSpeed.high;
                pieChart();
            }
        });
    }
    //访问webservice，查询并显示
    function getdatafromdate(user,beginDate,endDate){
        $.ajax({
            type: "post",
            url: "/mservice/myDriveData",
            data: {'user':user,start:beginDate.toDateString(),end:endDate.toDateString()},
            dataType: "json",
            success: function (result,status) {
                //alert(result.fuelData.length);
                document.getElementById("avgFuel").innerHTML=result.fuelDataLastInterval.fuel+"升/百公里";
                document.getElementById("miles").innerHTML=result.fuelDataLastInterval.mileage+"公里";
                document.getElementById("totalFuel").innerHTML=result.fuelDataLastInterval.totalFuel+"升";
                //document.getElementById("fuelLable").innerHTML="本时间段行驶平均油耗为：";
                //alert("开始转换");
                fuelChartData= fuelChartDataConvert(result.fuelData); //alert("油耗转换完成");
                document.getElementById("fuel_chart").innerHTML="";
                document.getElementById("fuel_y_axis").innerHTML="";
                document.getElementById("fuel_chartStart").innerHTML=beginDate.getFullYear()+"-"+(beginDate.getMonth()+1)+"-"+beginDate.getDate();
                document.getElementById("fuel_chartEnd").innerHTML=endDate.getFullYear()+"-"+(endDate.getMonth()+1)+"-"+endDate.getDate();

                carbonChartData =carbonChartDataConvert(result.carbonData); //alert("碳转换完成");
                //document.getElementById("lastCarbon").innerHTML=result.carbonDataLastTime.carbon+"kg";
                //document.getElementById("weekCarbon").innerHTML=result.carbonDataLastWeek.carbon+"kg";
                document.getElementById("monthCarbon").innerHTML=result.carbonDataLastInterval.carbon+"kg";
                document.getElementById("carbon_chart").innerHTML="";
                document.getElementById("carbon_y_axis").innerHTML="";
                document.getElementById("carbon_chartStart").innerHTML=beginDate.getFullYear()+"-"+(beginDate.getMonth()+1)+"-"+beginDate.getDate();
                document.getElementById("carbon_chartEnd").innerHTML=endDate.getFullYear()+"-"+(endDate.getMonth()+1)+"-"+endDate.getDate();
                //alert("驾驶行为开始");
                document.getElementById("nonthTurn").innerHTML=result.behaviorDataInterval.turnInterval;
                document.getElementById("monthSpeedup").innerHTML=result.behaviorDataInterval.speedupInterval;
                document.getElementById("monthSpeeddown").innerHTML=result.behaviorDataInterval.speeddownInterval;
                //document.getElementById("behaviorLable").innerHTML="本时间段急转弯次数："
                behaviorChartData= driveChartDataConvert(result.behaviorData);//alert("行为转换完成");
                document.getElementById("drive_chart").innerHTML="";
                document.getElementById("drive_y_axis").innerHTML="";
                document.getElementById("drive_chartStart").innerHTML=beginDate.getFullYear()+"-"+(beginDate.getMonth()+1)+"-"+beginDate.getDate();
                document.getElementById("drive_chartEnd").innerHTML=endDate.getFullYear()+"-"+(endDate.getMonth()+1)+"-"+endDate.getDate();
                //alert("绘图开始");
                createChart();
                //document.getElementById("lastSlowSpeed").innerHTML=result.lastSpeed.slow;
                //document.getElementById("lastMiddleSpeed").innerHTML=result.lastSpeed.middle;
                //document.getElementById("lastHighSpeed").innerHTML=result.lastSpeed.high;
                //document.getElementById("weekSlowSpeed").innerHTML=result.weekSpeed.slow;
                //document.getElementById("weekMiddleSpeed").innerHTML=result.weekSpeed.middle;
                //document.getElementById("weekHighSpeed").innerHTML=result.weekSpeed.high;
                document.getElementById("monthSlowSpeed").innerHTML=result.intervalSpeed.slow;
                document.getElementById("monthMiddleSpeed").innerHTML=result.intervalSpeed.middle;
                document.getElementById("monthHighSpeed").innerHTML=result.intervalSpeed.high;
                createPie();
            }
        });
    }
    //将传回的数据转换为图表控件所需格式
    function driveChartDataConvert(data){
        var myData=new Array();
        for(i=0;i<3;i++){
            myData[i]={};
            myData[i].data=new Array();
        }
        myData[0].color="#c05020";
        myData[1].color="#30c020";
        myData[2].color="#6060c0";
        for(i=0;i<data.length;i++){
            myData[0].data[i]={}
            myData[0].data[i].x=i;
            myData[0].data[i].y=parseInt(data[i].behavior.speedup);
        }
        for(i=0;i<data.length;i++){
            myData[1].data[i]={}
            myData[1].data[i].x=i;
            myData[1].data[i].y=parseInt(data[i].behavior.speeddown);
        }
        for(i=0;i<data.length;i++){
            myData[2].data[i]={}
            myData[2].data[i].x=i;
            myData[2].data[i].y=parseInt(data[i].behavior.turn);
        }

        return myData;
    }
    //本地数据，用于演示
    behaviorChartData = [
        {   data: [ { x: 0, y: 78 }, { x: 1, y: 74 }, { x: 2, y: 38 }, { x: 3, y: 54 }, { x: 4, y: 32 } ],
            color: "#c05020"
        }, {
            data: [ { x: 0, y: 80 }, { x: 1, y: 38 }, { x: 2, y: 67 }, { x: 3, y:85}, { x: 4, y: 23} ],
            color: "#30c020"
        }, {
            data: [ { x: 0, y: 65 }, { x: 1, y: 98 }, { x: 2, y: 134 }, { x: 3, y: 76 }, { x: 4, y: 95 } ],
            color: "#6060c0"
        }
    ];
</script>
<script type="text/javascript">

function pieChart(){
    $('#container').highcharts({
        chart: {
            plotBackgroundColor: null,
            plotBorderWidth: null,
            plotShadow: false
        },
        title:false,
        tooltip: {
            pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
        },
        plotOptions: {
            pie: {
                allowPointSelect: true,
                cursor: 'pointer',
                dataLabels: {
                    enabled: true,
                    color: '#000000',
                    connectorColor: '#000000',
                    format: '<b>{point.name}</b>: {point.percentage:.1f} %'
                }
            }
        },
        series: [{
            type: 'pie',
            name: 'Browser share',
            data: [
                ['低速',   45.0],
                ['中速',    26.8],
                ['高速',    28.2]
            ]
        }]
    });
}
</script>
</body>
</html>
