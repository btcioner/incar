
<!DOCTYPE html>
<html>
<head>
    <title>预约保养</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <script  src="../mscripts/jquery-1.7.1.min.js"></script>
    <script  src="../mscripts/car.js"></script>

    <!--日期控件资源  -->
    <script  src="../mscripts/jquery.mobile.min.js"></script>
    <script  src="../mscripts/jqm-datebox-1.4.0.comp.flipbox.min.js"></script>

    <link rel="stylesheet" href="../mstyles/jqm-datebox.min.css">
    <link rel="stylesheet" href="../mstyles/jquery.mobile.min.css">
    <link rel="stylesheet" href="../mstyles/jqm-datebox.min.css">
    <!--日期控件资源结束  -->

    <style scoped>
         .textfield{
			  height:26px; font-size:16px;
			  }
           .tdStyle{
             text-align: right;
             width: 30%;;
           }
   </style>
<script type="text/javascript">
    var user;//用户openid
    var today;

     //页面加载初始化
        function init(){
			//获取当前日期，初始化日期控件
			 today = new Date();
              year=today.getFullYear();    //获取完整的年份(4位,1970-????)
            month=(today.getMonth()+1>9)?today.getMonth()+1:"0"+(today.getMonth()+1);     //获取当前月份(0-11,0代表1月)
            day=today.getDate()>9?today.getDate():"0"+today.getDate();;        //获取当前日(1-31)
            document.getElementById("start").value=year+"-"+month+"-"+day;
            user=getQueryString("user");
            searchUser();
		}
		
	   //提交预约数据
	   function submitBooking(){
           //判断开始、结束时间是否合法
           alert("开始");
           var postData={};
          if($('#end').val()==''||$('#end').val()==null){alert("请输入预约时间");return;}
          if($('#phone').val()==''||$('#phone').val()==null){alert("请输入联系电话");return;}
		  bookDate=new Date($('#start').val());
		  bookTime=new Date($('#end').val());
          bookTime.setHours($('#end').val().substring(0,1),$('#end').val().substring(3));
           postData.user=user;
           postData.nick=$('#ownerName').val();
           postData.bookingDate=bookDate;
           postData.bookingTime=bookTime
           postData.license=$('#license').val();
           postData.phone=$('#phone').val();
           postData.mileage=$('#mileage').val();
           postData.carType=$('#carType').val();
		  if(bookDate<=today) {alert("预约时间错误！");return;}
		   else {
               $.ajax({
                  type: "post",
                  url: "/mservice/slotBooking",
                  data:postData,
                  dataType: "json",
                  success: function (result,status) {
                      //alert(result.fuelData.length);
                     document.getElementById("bookStatus").innerHTML="<h3 style='text-align: center'>预约已提交，请注意查收返回信息！</h3>";
                  },
                  error:function(){
                      document.getElementById("bookStatus").innerHTML="<h3 style='text-align: center'>预约失败，请检查网络连接。！</h3>";
                  }
              });
             }
		   }

		
    </script>
</head>
<body onLoad="init()" >
    <div id="fuel" style="text-align: center" >
        <h4 >预约保养</h4>
      <hr color="#009900" style="height:5px" >

    </div>
       <div id="bookStatus" style="width: 100%">
          <table style="font-size:16px; margin-top:5px" cellspacing="3px">
             <tr><td class="tdStyle"> 预约日期</td><td> <input name="start" type="date" data-options='{"mode":"flipbox"}' data-role="datebox" id="start" style="vertical-align:middle;" /></td></tr>
              <tr><td class="tdStyle"> 预约时间</td><td><input name="end" type="date" data-options='{"mode":"timeflipbox"}' data-role="datebox" id="en" style="vertical-align:middle;" /></td></tr>
              <tr><td class="tdStyle"> 车主姓名</td><td><input name="ownerName" type="text" class="textfield" id="ownerName"/></td></tr>
             <tr><td class="tdStyle"> 联系电话</td><td><input name="phone" type="text" class="textfield" id="phone"/></td></tr>
             <tr><td class="tdStyle"> 车牌号</td><td><input name="license" type="text" class="textfield" id="license"/></td></tr>
             <tr><td class="tdStyle"> 车型</td><td><input name="carType" type="text" class="textfield" id="carType"/></td></tr>
             <tr><td td class="tdStyle"> 里程</td><td><input name="mileage" type="text" class="textfield" id="mileage"/></td></tr>d
          </table>
         
       </div>
        <p align="center">
         <input type="button" value="&nbsp;预&nbsp;&nbsp;约&nbsp;" class="textfield" style="width:100%; height:60px" onclick="submitBooking()"/>

            <script>
                function searchUser(){
                    $.ajax({
                        type: "POST",
                        url: "/mservice/infoConfig",
                        data: {'user':user},
                        dataType: "json",
                        success: function (result,status) {
                            //document.getElementById('name').value=result.name;
                            //document.getElementById('password').value=result.name;
                            //document.getElementById('username').value=result.name;
                            //document.getElementById('obd_code').value=result.obd_code;
                            document.getElementById('carType').innerHTML=result.brandName;
                           // document.getElementById('seleBrand').value=result.brand;
                           // document.getElementById('seleSeries').innerHTML=result.seriesName;
                           // document.getElementById('seleSeries').value=result.series;
                            //document.getElementById('seleModelYear').innerHTML=result.modelYear;
                            //document.getElementById('seleModelYear').value=result.modelYear;
                            document.getElementById('license').value=result.license;
                            document.getElementById('mileage').value=result.mileage;
                           // document.getElementById('seleAge').innerHTML=result.age+'年';
                            //document.getElementById('seleAge').value=result.age;
                            //document.getElementById('seleDisp').innerHTML=result.disp;
                            //document.getElementById('seleDisp').value=result.disp;
                            document.getElementById('phone').value=result.phone;
                            document.getElementById('ownerName').value=result.nick;

                        },
                        error:function(XMLHttpRequest, textStatus, errorThrown){
                            alert("连接失败\n请检查网络连接是否正常");
                        }
                    });
                }

            </script>

</body>
</html>
