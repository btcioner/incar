
<!DOCTYPE html>
<html>
<head>
    <title>预约保养</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <script  src="../mscripts/jquery-1.7.1.min.js"></script>
    <script  src="../mscripts/car.js"></script>

    <!--日期控件资源  -->
    <script  src="../mscripts/jqm-datebox-1.4.0.comp.flipbox.min.js"></script>
    <script  src="../mscripts/jquery.mobile.min.js"></script>

    <link href="../mstyles/pagestyle.css" rel="stylesheet" type="text/css" />
    <link href="../mstyles/regsiterstyle.css" rel="stylesheet" type="text/css" />

    <link rel="stylesheet" href="../mstyles/jquery.mobile.min.css">
    <link rel="stylesheet" href="../mstyles/jqm-datebox.min.css">

    <!--日期控件资源结束  -->

    <style scoped>
         .textfield{
			  height:26px; font-size:16px;
			  }
           .tdStyle{
             text-align: right;
             width: 30%;;
           }
   </style>
<script type="text/javascript">
    var user;//用户openid
    var today;

     //页面加载初始化
        function init(){
			//获取当前日期，初始化日期控件
			 today = new Date();
              year=today.getFullYear();    //获取完整的年份(4位,1970-????)
            month=(today.getMonth()+1>9)?today.getMonth()+1:"0"+(today.getMonth()+1);     //获取当前月份(0-11,0代表1月)
            day=today.getDate()>9?today.getDate():"0"+today.getDate();;        //获取当前日(1-31)
            document.getElementById("start").value=year+"-"+month+"-"+day;
            user=getQueryString("user");
            searchUser();
		}
		
	   //提交预约数据
	   function submitBooking(){
           //判断开始、结束时间是否合法
           //alert("开始");
           var postData={};
          if($('#start').val()==''||$('#end').val()==''){alert("请输入预约时间");return;}
          if($('#phone').val()==''||$('#phone').val()==null){alert("请输入联系电话");return;}
		  bookDate=new Date(document.getElementById("start").value);
           //alert(bookDate);
		  bookTime=new Date(document.getElementById("start").value);
          bookTime.setHours($('#end').val().substring(0,1),$('#end').val().substring(3));
           //alert(bookTime);
           postData.user=user;
           postData.nick=$('#ownerName').val();
           postData.bookingDate=bookDate.toDateString();
           postData.bookingTime=bookTime.toDateString();
           postData.license=$('#license').val();
           postData.phone=$('#phone').val();
           postData.mileage=$('#mileage').val();
           postData.carType=$('#carType').val();
           //alert("33333333");
		  if(bookDate<=today) {alert("预约时间错误！");return;}
		   else {
               $.ajax({
                  type: "post",
                  url: "/mservice/slotBooking",
                  data:postData,
                  dataType: "json",
                  success: function (result,status) {
                      //alert(result.fuelData.length);
                     document.getElementById("bookStatus").innerHTML="<h3 style='text-align: center'>预约已提交，请注意查收返回信息！</h3>";
                  },
                  error:function(){
                      document.getElementById("bookStatus").innerHTML="<h3 style='text-align: center'>预约失败，请检查网络连接。！</h3>";
                  }
              });
             }
		   }

		
    </script>
</head>
<body onLoad="init()" >
<div id="wrap">
    <!--main_wrap start-->
    <div id="main_wrap">
        <!--containe_280 start--><div id="containe_280">
        <div class="img_01"></div>
        <!--预约保养表单contentboxstyle01 start--><div class="contentboxstyle01">
        <div class="formstyle01"><ul><li>车主姓名*：</li><li><input name="ownerName" id="ownerName" type="text" class="w190" /></li></ul><div class="clear"></div></div>
        <div class="formstyle01"><ul><li>联系电话*：</li><li><input name="phone" id="phone" type="text" class="w190" /></li></ul><div class="clear"></div></div>
        <div class="formstyle01"><ul><li>车&nbsp;&nbsp;牌&nbsp;&nbsp;号*：</li><li><input name="license" id="license" type="text" class="w190" /></li></ul><div class="clear"></div></div>
        <div class="formstyle01"><ul><li>预约日期*：</li><li><input name="start" id="start" type="text" class="w190" type="date" data-options='{"mode":"flipbox"}' data-role="datebox" style="vertical-align: middle"/></li></ul><div class="clear"></div></div>
        <div class="formstyle01"><ul><li>预约时间*：</li><li><input name="end" id="end" type="text" class="w190" type="date" data-options='{"mode":"timeflipbox"}' data-role="datebox" style="vertical-align: middle"/></li></ul><div class="clear"></div></div>
        <div class="formstyle01"><ul><li>车&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;型*：</li><li><input name="carType" id="carType" type="text" class="w190" /></li></ul><div class="clear"></div></div>
        <div class="formstyle01"><ul><li>当前里程*：</li><li><input name="mileage" id="mileage" type="text" class="w190" /></li></ul><div class="clear"></div></div>
    </div><!--预约保养表单contentboxstyle01 end-->
    </div><!--containe_280 end-->
        <div class="w10"></div>
        <!--regsiterbutton start--><div id="regsiterbutton"><span class="text_02">*号为必填项</span><br /><a href="#" class="button01" onclick="submitBooking()">提&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;交</a></div><!--regsiterbutton end-->
    </div><!--main_wrap end-->
</div>
            <script>
                function searchUser(){
                    $.ajax({
                        type: "POST",
                        url: "/mservice/infoConfig",
                        data: {'user':user},
                        dataType: "json",
                        success: function (result,status) {
                            //document.getElementById('name').value=result.name;
                            //document.getElementById('password').value=result.name;
                            //document.getElementById('username').value=result.name;
                            //document.getElementById('obd_code').value=result.obd_code;
                            document.getElementById('carType').innerHTML=result.brandName;
                           // document.getElementById('seleBrand').value=result.brand;
                           // document.getElementById('seleSeries').innerHTML=result.seriesName;
                           // document.getElementById('seleSeries').value=result.series;
                            //document.getElementById('seleModelYear').innerHTML=result.modelYear;
                            //document.getElementById('seleModelYear').value=result.modelYear;
                            document.getElementById('license').value=result.license;
                            document.getElementById('mileage').value=result.mileage;
                           // document.getElementById('seleAge').innerHTML=result.age+'年';
                            //document.getElementById('seleAge').value=result.age;
                            //document.getElementById('seleDisp').innerHTML=result.disp;
                            //document.getElementById('seleDisp').value=result.disp;
                            document.getElementById('phone').value=result.phone;
                            document.getElementById('ownerName').value=result.nick;

                        },
                        error:function(XMLHttpRequest, textStatus, errorThrown){
                            alert("连接失败\n请检查网络连接是否正常");
                        }
                    });
                }

            </script>

</body>
</html>
